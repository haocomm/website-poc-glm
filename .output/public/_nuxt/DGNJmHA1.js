import E from"./LRZgX-Ci.js";import K from"./q-JK5kLX.js";import q from"./ZB2_K6q9.js";import G from"./kEgi6I2y.js";import H from"./K_RD6kwO.js";import J from"./CPm9_Uib.js";import O from"./ChIKfHYQ.js";import P from"./CRaHfOC0.js";import{e as W,r as c,f as Q,g as X,h as Y,u as Z,c as m,a as e,b as n,w as l,F as R,i as V,j as a,t as d,k as tt,l as S,o as u,n as et,d as k}from"./rXjCf5nY.js";import"./Dj0sbWsm.js";import"./C6XMGHRq.js";import"./DidrvKe_.js";import"./BJ2ClxiI.js";import"./Cd8xZgT4.js";import"./CqixAVAd.js";import"./DVbDOtTj.js";import"./CHOj1P8S.js";import"./B7T39L2X.js";import"./CUlfEDMs.js";import"./Da75c_b9.js";import"./BWqAz1Ry.js";import"./7ezJ8D-b.js";import"./NvVY9mVC.js";import"./BqNqVi9c.js";import"./Cym1VOnw.js";import"./Bm92f-5u.js";import"./CxIZtCgj.js";import"./2cLrE68T.js";const ot={class:"min-h-screen bg-gray-50 dark:bg-gray-900"},st={class:"container mx-auto px-4 py-8"},at={class:"grid grid-cols-1 lg:grid-cols-4 gap-6 h-screen"},nt={class:"lg:col-span-1 bg-white dark:bg-gray-800 rounded-lg shadow p-4"},rt={class:"flex justify-between items-center mb-4"},lt={class:"space-y-2"},it=["onClick"],ct={class:"font-medium text-gray-900 dark:text-white"},dt={class:"text-sm text-gray-500 dark:text-gray-400"},mt={class:"lg:col-span-3 bg-white dark:bg-gray-800 rounded-lg shadow flex flex-col"},ut={key:0,class:"flex-1 flex items-center justify-center"},pt={key:1,class:"flex-1 flex flex-col"},_t={class:"p-4 border-b border-gray-200 dark:border-gray-700"},ft={class:"text-lg font-semibold text-gray-900 dark:text-white"},gt={class:"text-sm text-gray-500 dark:text-gray-400"},ht={class:"flex-1 p-4 overflow-y-auto chat-messages"},xt={class:"flex items-start space-x-3"},yt={class:"flex-shrink-0"},vt={class:"w-8 h-8 bg-primary-500 rounded-full flex items-center justify-center"},kt={class:"text-white text-sm font-medium"},bt={class:"flex-1"},wt={class:"flex items-center space-x-2"},Ut={class:"font-medium text-gray-900 dark:text-white"},Ct={class:"text-xs text-gray-500 dark:text-gray-400"},Rt={class:"text-gray-700 dark:text-gray-300"},Vt={class:"p-4 border-t border-gray-200 dark:border-gray-700"},St={class:"flex space-x-4"},$t={class:"flex justify-end space-x-3"},re={__name:"chat",setup(jt){const $=W(),f=c([]),g=c(null),b=c(""),x=c([]),p=c(""),j=c([]),_=c(!1),y=c(!1),i=Q({name:"",description:""});let r=null;X(async()=>{if(!localStorage.getItem("auth_token")){await $.push("/auth/login");return}await F(),B()});async function F(){try{const s=localStorage.getItem("auth_token");f.value=await $fetch("/api/chat/rooms",{headers:{Authorization:`Bearer ${s}`},baseURL:"http://localhost:3001"})}catch(s){console.error("Failed to load rooms:",s)}}function B(){const s=localStorage.getItem("auth_token");r=io("http://localhost:3001",{auth:{token:s}}),r.on("connect",()=>{console.log("Connected to socket server")}),r.on("new-message",t=>{x.value.push(t)}),r.on("user-joined",t=>{console.log("User joined:",t)}),r.on("user-left",t=>{console.log("User left:",t)})}async function z(s){g.value=s;const t=f.value.find(v=>v._id===s);b.value=t.name,r&&r.emit("join-room",s),await I(s)}async function I(s){try{const t=localStorage.getItem("auth_token");x.value=await $fetch(`/api/chat/rooms/${s}/messages`,{headers:{Authorization:`Bearer ${t}`},baseURL:"http://localhost:3001"})}catch(t){console.error("Failed to load messages:",t)}}function w(){!p.value.trim()||!r||(r.emit("send-message",{roomId:g.value,content:p.value.trim(),type:"text"}),p.value="")}async function N(){y.value=!0;try{const s=localStorage.getItem("auth_token"),t=await $fetch("/api/chat/rooms",{method:"POST",headers:{Authorization:`Bearer ${s}`},body:i,baseURL:"http://localhost:3001"});f.value.push(t.room),_.value=!1,i.name="",i.description=""}catch(s){console.error("Failed to create room:",s)}finally{y.value=!1}}function T(s){return new Date(s).toLocaleTimeString()}return Y(()=>{r&&r.disconnect()}),Z({title:"Chat - Chat App",meta:[{name:"description",content:"Join real-time conversations"}]}),(s,t)=>{const v=E,h=K,U=q,C=G,A=H,L=J,M=O,D=P;return u(),m("div",ot,[e("div",st,[e("div",at,[e("div",nt,[e("div",rt,[t[6]||(t[6]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"}," Chat Rooms ",-1)),n(h,{size:"sm",color:"primary",variant:"soft",onClick:t[0]||(t[0]=o=>_.value=!0)},{default:l(()=>[n(v,{name:"i-heroicons-plus"})]),_:1})]),e("div",lt,[(u(!0),m(R,null,V(a(f),o=>(u(),m("div",{key:o._id,onClick:Ft=>z(o._id),class:et(["p-3 rounded-lg cursor-pointer transition-colors",a(g)===o._id?"bg-primary-100 dark:bg-primary-900":"hover:bg-gray-100 dark:hover:bg-gray-700"])},[e("div",ct,d(o.name),1),e("div",dt,d(o.members?.length||0)+" members ",1)],10,it))),128))])]),e("div",mt,[a(g)?(u(),m("div",pt,[e("div",_t,[e("h3",ft,d(a(b)),1),e("div",gt,d(a(j).length)+" users online ",1)]),e("div",ht,[(u(!0),m(R,null,V(a(x),o=>(u(),m("div",{key:o.id,class:"mb-4"},[e("div",xt,[e("div",yt,[e("div",vt,[e("span",kt,d(o.username?.[0]?.toUpperCase()),1)])]),e("div",bt,[e("div",wt,[e("span",Ut,d(o.username),1),e("span",Ct,d(T(o.timestamp)),1)]),e("div",Rt,d(o.content),1)])])]))),128))]),e("div",Vt,[e("div",St,[n(U,{modelValue:a(p),"onUpdate:modelValue":t[1]||(t[1]=o=>S(p)?p.value=o:null),placeholder:"Type your message...",onKeyup:tt(w,["enter"]),class:"flex-1"},null,8,["modelValue"]),n(h,{onClick:w,color:"primary",variant:"solid"},{default:l(()=>[...t[8]||(t[8]=[k(" Send ",-1)])]),_:1})])])])):(u(),m("div",ut,[...t[7]||(t[7]=[e("div",{class:"text-center"},[e("h3",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-2"}," Welcome to Chat App "),e("p",{class:"text-gray-600 dark:text-gray-400"}," Select a room from the sidebar to start chatting ")],-1)])]))])])]),n(D,{modelValue:a(_),"onUpdate:modelValue":t[5]||(t[5]=o=>S(_)?_.value=o:null)},{default:l(()=>[n(M,null,{header:l(()=>[...t[9]||(t[9]=[e("h3",{class:"text-lg font-semibold"},"Create New Room",-1)])]),default:l(()=>[n(L,{state:a(i),onSubmit:N,class:"space-y-4"},{default:l(()=>[n(C,{label:"Room Name",name:"name"},{default:l(()=>[n(U,{modelValue:a(i).name,"onUpdate:modelValue":t[2]||(t[2]=o=>a(i).name=o),placeholder:"Enter room name",required:""},null,8,["modelValue"])]),_:1}),n(C,{label:"Description",name:"description"},{default:l(()=>[n(A,{modelValue:a(i).description,"onUpdate:modelValue":t[3]||(t[3]=o=>a(i).description=o),placeholder:"Enter room description (optional)"},null,8,["modelValue"])]),_:1}),e("div",$t,[n(h,{onClick:t[4]||(t[4]=o=>_.value=!1),variant:"soft"},{default:l(()=>[...t[10]||(t[10]=[k(" Cancel ",-1)])]),_:1}),n(h,{type:"submit",color:"primary",loading:a(y)},{default:l(()=>[...t[11]||(t[11]=[k(" Create Room ",-1)])]),_:1},8,["loading"])])]),_:1},8,["state"])]),_:1})]),_:1},8,["modelValue"])])}}};export{re as default};
