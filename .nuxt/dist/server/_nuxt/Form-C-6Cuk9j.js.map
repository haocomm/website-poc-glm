{"version":3,"file":"Form-C-6Cuk9j.js","sources":["../../../../node_modules/.pnpm/@nuxt+ui@2.22.3_magicast@0.5.0_tsx@4.20.6_vite@7.1.12_@types+node@20.19.24_jiti@2.6.1_t_32e2b60713db3d07f60c2d3c3af648d7/node_modules/@nuxt/ui/dist/runtime/components/forms/Form.vue"],"sourcesContent":["<template>\n  <form @submit.prevent=\"onSubmit\">\n    <slot v-bind=\"{ errors }\" />\n  </form>\n</template>\n\n<script>\nimport { provide, ref, defineComponent, onUnmounted, onMounted, readonly } from \"vue\";\nimport { useEventBus } from \"@vueuse/core\";\nimport { useId } from \"#imports\";\nclass FormException extends Error {\n  constructor(message) {\n    super(message);\n    this.message = message;\n    Object.setPrototypeOf(this, FormException.prototype);\n  }\n}\nexport default defineComponent({\n  props: {\n    schema: {\n      type: [Object, Function],\n      default: void 0\n    },\n    state: {\n      type: Object,\n      required: true\n    },\n    validate: {\n      type: Function,\n      default: () => []\n    },\n    validateOn: {\n      type: Array,\n      default: () => [\"blur\", \"input\", \"change\", \"submit\"]\n    }\n  },\n  emits: [\"submit\", \"error\"],\n  setup(props, { expose, emit }) {\n    const formId = useId();\n    const bus = useEventBus(`form-${formId}`);\n    const parsedValue = ref(null);\n    onMounted(() => {\n      bus.on(async (event) => {\n        if (event.type !== \"submit\" && props.validateOn?.includes(event.type)) {\n          await validate(event.path, { silent: true });\n        }\n      });\n    });\n    onUnmounted(() => {\n      bus.reset();\n    });\n    const errors = ref([]);\n    provide(\"form-errors\", errors);\n    provide(\"form-events\", bus);\n    const inputs = ref({});\n    provide(\"form-inputs\", inputs);\n    async function getErrors() {\n      let errs = await props.validate(props.state);\n      if (props.schema) {\n        const { errors: errors2, result } = await parseSchema(props.state, props.schema);\n        if (errors2) {\n          errs = errs.concat(errors2);\n        } else {\n          parsedValue.value = result;\n        }\n      }\n      return errs;\n    }\n    async function validate(path, opts = { silent: false }) {\n      let paths = path;\n      if (path && !Array.isArray(path)) {\n        paths = [path];\n      }\n      if (paths) {\n        const otherErrors = errors.value.filter(\n          (error) => !paths.includes(error.path)\n        );\n        const pathErrors = (await getErrors()).filter(\n          (error) => paths.includes(error.path)\n        );\n        errors.value = otherErrors.concat(pathErrors);\n      } else {\n        errors.value = await getErrors();\n      }\n      if (errors.value.length > 0) {\n        if (opts.silent) return false;\n        throw new FormException(\n          `Form validation failed: ${JSON.stringify(errors.value, null, 2)}`\n        );\n      }\n      return props.state;\n    }\n    async function onSubmit(payload) {\n      const event = payload;\n      try {\n        if (props.validateOn?.includes(\"submit\")) {\n          await validate();\n        }\n        event.data = props.schema ? parsedValue.value : props.state;\n        emit(\"submit\", event);\n      } catch (error) {\n        if (!(error instanceof FormException)) {\n          throw error;\n        }\n        const errorEvent = {\n          ...event,\n          errors: errors.value.map((err) => ({\n            ...err,\n            id: inputs.value[err.path]\n          }))\n        };\n        emit(\"error\", errorEvent);\n      }\n    }\n    expose({\n      validate,\n      errors,\n      setErrors(errs, path) {\n        if (path) {\n          errors.value = errors.value.filter(\n            (error) => error.path !== path\n          ).concat(errs);\n        } else {\n          errors.value = errs;\n        }\n      },\n      async submit() {\n        await onSubmit(new Event(\"submit\"));\n      },\n      getErrors(path) {\n        if (path) {\n          return errors.value.filter((err) => err.path === path);\n        }\n        return errors.value;\n      },\n      clear(path) {\n        if (path) {\n          errors.value = errors.value.filter((err) => err.path !== path);\n        } else {\n          errors.value = [];\n        }\n      }\n    });\n    return {\n      onSubmit,\n      errors: readonly(errors)\n    };\n  }\n});\nfunction isYupSchema(schema) {\n  return schema.validate && schema.__isYupSchema__;\n}\nfunction isYupError(error) {\n  return error.inner !== void 0;\n}\nfunction isSuperStructSchema(schema) {\n  return \"schema\" in schema && typeof schema.coercer === \"function\" && typeof schema.validator === \"function\" && typeof schema.refiner === \"function\";\n}\nfunction isJoiSchema(schema) {\n  return schema.validateAsync !== void 0 && schema.id !== void 0;\n}\nfunction isJoiError(error) {\n  return error.isJoi === true;\n}\nexport function isStandardSchema(schema) {\n  return \"~standard\" in schema;\n}\nexport async function validateStandardSchema(state, schema) {\n  const result = await schema[\"~standard\"].validate(state);\n  if (!result.issues || result.issues.length === 0) {\n    const output = \"value\" in result ? result.value : null;\n    return {\n      errors: null,\n      result: output\n    };\n  }\n  const errors = result.issues.map((issue) => ({\n    path: issue.path?.map((item) => typeof item === \"object\" ? item.key : item).join(\".\") || \"\",\n    message: issue.message\n  }));\n  return {\n    errors,\n    result: null\n  };\n}\nasync function validateJoiSchema(state, schema) {\n  try {\n    const result = await schema.validateAsync(state, { abortEarly: false });\n    return {\n      errors: null,\n      result\n    };\n  } catch (error) {\n    if (isJoiError(error)) {\n      const errors = error.details.map((issue) => ({\n        path: issue.path.join(\".\"),\n        message: issue.message\n      }));\n      return {\n        errors,\n        result: null\n      };\n    } else {\n      throw error;\n    }\n  }\n}\nasync function validateSuperstructSchema(state, schema) {\n  const [err, result] = schema.validate(state);\n  if (err) {\n    const errors = err.failures().map((error) => ({\n      message: error.message,\n      path: error.path.join(\".\")\n    }));\n    return {\n      errors,\n      result: null\n    };\n  }\n  return {\n    errors: null,\n    result\n  };\n}\nasync function validateYupSchema(state, schema) {\n  try {\n    const result = await schema.validate(state, { abortEarly: false });\n    return {\n      errors: null,\n      result\n    };\n  } catch (error) {\n    if (isYupError(error)) {\n      const errors = error.inner.map((issue) => ({\n        path: issue.path ?? \"\",\n        message: issue.message\n      }));\n      return {\n        errors,\n        result: null\n      };\n    } else {\n      throw error;\n    }\n  }\n}\nfunction parseSchema(state, schema) {\n  if (isStandardSchema(schema)) {\n    return validateStandardSchema(state, schema);\n  } else if (isJoiSchema(schema)) {\n    return validateJoiSchema(state, schema);\n  } else if (isYupSchema(schema)) {\n    return validateYupSchema(state, schema);\n  } else if (isSuperStructSchema(schema)) {\n    return validateSuperstructSchema(state, schema);\n  } else {\n    throw new Error(\"Form validation failed: Unsupported form schema\");\n  }\n}\n</script>\n"],"names":[],"mappings":"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","x_google_ignoreList":[0]}